<div id="ajax_info" style="color:green"></div>
<div id="comments_list">
  <% if object.comments.length > 0 %>
    <h2><%= image_tag 'icons/comments.png'%><%=I18n.t('general.object.comment').pluralize.camelize %></h2>
    <div class="comment_bloc">
      <%= render :partial => "comments/comment_in_list", :collection => object.comments %>
    </div>
  <% end %>
</div>

<% if permission || @current_object.accepts_comment_for?(@current_user) %>
  <div id ="reply" style="display:none;top: 242px; margin-top: 0pt;">
    <fieldset id="new_reply_form_box" style="margin-top:10px">
      <div id="'reply_content">
        <%=link_to_function image_tag('/images/x_grey.png'), :onclick => "$('reply').style.display='none'", :style => "float:right;padding-top:10px;" %>
        <p><%= I18n.t('general.common_word.your').camelize+ ' Reply'%> : </p>
        <form id onsubmit="if($('reply_box').value != 0){new Ajax.Request('<%=add_reply_comment_path(@current_object)%>', {asynchronous:true, evalScripts:true, onComplete:function(request){$('reply_box').writeAttribute('disabled', false);$('reply_box').value = '';$('reply').style.display='none';}, onLoading:function(request){$('reply_box').writeAttribute('disabled')}, parameters:Form.serialize(this)}); return false;}else{return false;}" method="post" action="<%=add_reply_comment_path(@current_object)%>">
          <textarea id="reply_box" class="comment_box" rows="4" name="comment[text]" cols="60"></textarea>
          <% if !current_user %>
            <div id="captcha" style="width:30%">
              <%= render :partial => "/items/captcha" %>
            </div>
          <% end %>
          <input type="hidden" id ="comment_parent_id" name="comment[parent_id]">
          <button type="submit" class="submit_button">Reply</button>
        </form>
      </div>

    </fieldset>
  </div>
<% end %>
<% if permission || @current_object.accepts_comment_for?(@current_user) %>
  <fieldset id="new_comment_form_box">
    <p><%= I18n.t('general.common_word.your').camelize+' '+I18n.t('general.object.comment')%> :</p>
    <form id="new_comment" class="new_comment" onsubmit="if($('comment_box').value != 0){new Ajax.Request('<%=add_comment_item_path(@current_object)%>', {asynchronous:true, evalScripts:true, onComplete:function(request){$('comment_box').writeAttribute('disabled', false);$('comment_box').value = ''}, onLoading:function(request){$('comment_box').writeAttribute('disabled')}, parameters:Form.serialize(this)}); return false;}else{return false;}" method="post" action="<%=add_comment_item_path(@current_object)%>">
      <textarea id="comment_box" class="comment_box" rows="8" name="comment[text]" cols="90"></textarea>
      <% if !current_user %>
        <div id="captcha" style="width:30%">
          <%= render :partial => "/items/captcha" %>
        </div>
      <% end %>
      <button type="submit" class="submit_button"><%=I18n.t('comment.add_comment.button_publish')%></button>
    </form>
  </fieldset>
<% end %>

<script type="text/javascript">
  function add_reply(parent){
    if($('reply')){
      $('reply').style.display = 'block';
      $('comment_parent_id').value = parent;
    }
  }
</script>