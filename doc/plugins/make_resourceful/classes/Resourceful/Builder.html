<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Resourceful::Builder</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Resourceful::Builder</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/vendor/plugins/make_resourceful/lib/resourceful/builder_rb.html">
                vendor/plugins/make_resourceful/lib/resourceful/builder.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="Maker.html#M000006">Maker#make_resourceful</a> block is
evaluated in the context of an instance of this class. It provides various
methods for customizing the behavior of the <a
href="Builder.html#M000063">actions</a> built by make_resourceful.
</p>
<p>
All instance methods of this class are available in the
<tt>make_resourceful</tt> block.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000063">actions</a>&nbsp;&nbsp;
      <a href="#M000066">after</a>&nbsp;&nbsp;
      <a href="#M000062">apply</a>&nbsp;&nbsp;
      <a href="#M000065">before</a>&nbsp;&nbsp;
      <a href="#M000069">belongs_to</a>&nbsp;&nbsp;
      <a href="#M000064">build</a>&nbsp;&nbsp;
      <a href="#M000070">inherited?</a>&nbsp;&nbsp;
      <a href="#M000061">new</a>&nbsp;&nbsp;
      <a href="#M000068">publish</a>&nbsp;&nbsp;
      <a href="#M000067">response_for</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">controller</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
The klass of the controller on which the builder is working.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000061" class="method-detail">
        <a name="M000061"></a>

        <div class="method-heading">
          <a href="#M000061" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(kontroller)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The constructor is only meant to be called internally.
</p>
<p>
This takes the klass (class object) of a controller and constructs a <a
href="Builder.html">Builder</a> ready to <a
href="Builder.html#M000062">apply</a> the make_resourceful additions to the
controller.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000061-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000061-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 21</span>
21:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">kontroller</span>)
22:       <span class="ruby-ivar">@controller</span>       = <span class="ruby-identifier">kontroller</span>
23:       <span class="ruby-ivar">@inherited</span>        = <span class="ruby-operator">!</span><span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">read_inheritable_attribute</span>(<span class="ruby-identifier">:resourceful_responses</span>).<span class="ruby-identifier">blank?</span>
24:       <span class="ruby-ivar">@action_module</span>    = <span class="ruby-constant">Resourceful</span><span class="ruby-operator">::</span><span class="ruby-constant">Default</span><span class="ruby-operator">::</span><span class="ruby-constant">Actions</span>.<span class="ruby-identifier">dup</span>
25:       <span class="ruby-ivar">@ok_actions</span>       = []
26:       <span class="ruby-ivar">@callbacks</span>        = {<span class="ruby-identifier">:before</span> =<span class="ruby-operator">&gt;</span> {}, <span class="ruby-identifier">:after</span> =<span class="ruby-operator">&gt;</span> {}}
27:       <span class="ruby-ivar">@responses</span>        = {}
28:       <span class="ruby-ivar">@publish</span>          = {}
29:       <span class="ruby-ivar">@parents</span>          = []
30:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000063" class="method-detail">
        <a name="M000063"></a>

        <div class="method-heading">
          <a href="#M000063" class="method-signature">
          <span class="method-name">actions(*available_actions)<br />
actions :all<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds the default RESTful <a href="Builder.html#M000063">actions</a> to the
controller.
</p>
<p>
If the only argument is <tt>:all</tt>, adds all the <a
href="Builder.html#M000063">actions</a> listed in <a
href="../Resourceful.html">Resourceful::ACTIONS</a> (or <a
href="../Resourceful.html">Resourceful::SINGULAR_ACTIONS</a> for a singular
controller).
</p>
<p>
Otherwise, this adds all <a href="Builder.html#M000063">actions</a> whose
names were passed as arguments.
</p>
<p>
For example:
</p>
<pre>
  actions :show, :new, :create
</pre>
<p>
This adds the <tt>show</tt>, <tt><a
href="Builder.html#M000061">new</a></tt>, and <tt>create</tt> <a
href="Builder.html#M000063">actions</a> to the controller.
</p>
<p>
The available <a href="Builder.html#M000063">actions</a> are defined in <a
href="Default/Actions.html">Default::Actions</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000063-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000063-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 83</span>
83:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">actions</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">available_actions</span>)
84:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">available_actions</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:all</span>
85:         <span class="ruby-identifier">available_actions</span> = <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">plural?</span> <span class="ruby-value">? </span><span class="ruby-constant">ACTIONS</span> <span class="ruby-operator">:</span> <span class="ruby-constant">SINGULAR_ACTIONS</span>
86:       <span class="ruby-keyword kw">end</span>
87: 
88:       <span class="ruby-identifier">available_actions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">action</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@ok_actions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">to_sym</span> }
89:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000066" class="method-detail">
        <a name="M000066"></a>

        <div class="method-heading">
          <a href="#M000066" class="method-signature">
          <span class="method-name">after(*events) { ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up a block of code to run <a href="Builder.html#M000066">after</a> one
or more events.
</p>
<p>
There are two sorts of <tt><a href="Builder.html#M000066">after</a></tt>
events. <tt>:create</tt>, <tt>:update</tt>, and <tt>:destroy</tt> are run
<a href="Builder.html#M000066">after</a> their respective database
operations have been completed successfully. <tt>:create_fails</tt>,
<tt>:update_fails</tt>, and <tt>:destroy_fails</tt>, on the other hand, are
run <a href="Builder.html#M000066">after</a> the database operations fail.
</p>
<p>
<tt><a href="Builder.html#M000066">after</a></tt> events are run <a
href="Builder.html#M000066">after</a> the database operations but <a
href="Builder.html#M000065">before</a> any responses.
</p>
<p>
For example:
</p>
<pre>
  after :create_fails, :update_fails do
    current_object.password = nil
  end
</pre>
<p>
This will nillify the password of the current object if the object
creation/modification failed.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000066-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000066-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">events</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
157:       <span class="ruby-identifier">add_callback</span> <span class="ruby-identifier">:after</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">events</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
158:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000062" class="method-detail">
        <a name="M000062"></a>

        <div class="method-heading">
          <a href="#M000062" class="method-signature">
          <span class="method-name">apply</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is only meant to be called internally.
</p>
<p>
Applies all the changes that have been declared via the instance methods of
this <a href="Builder.html">Builder</a> to the kontroller passed in to the
constructor.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000062-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000062-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 37</span>
37:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">apply</span>
38:       <span class="ruby-identifier">apply_publish</span>
39: 
40:       <span class="ruby-identifier">kontroller</span> = <span class="ruby-ivar">@controller</span>
41:       <span class="ruby-constant">Resourceful</span><span class="ruby-operator">::</span><span class="ruby-constant">ACTIONS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action_named</span><span class="ruby-operator">|</span>
42:         <span class="ruby-comment cmt"># See if this is a method listed by #actions</span>
43:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@ok_actions</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">action_named</span>
44:           <span class="ruby-comment cmt"># If its not listed, then remove the method</span>
45:           <span class="ruby-comment cmt"># No one can hit it... if its DEAD!</span>
46:           <span class="ruby-ivar">@action_module</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:remove_method</span>, <span class="ruby-identifier">action_named</span>
47:         <span class="ruby-keyword kw">end</span>
48:       <span class="ruby-keyword kw">end</span>
49: 
50:       <span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">hidden_actions</span>.<span class="ruby-identifier">reject!</span> <span class="ruby-operator">&amp;</span><span class="ruby-ivar">@ok_actions</span>.<span class="ruby-identifier">method</span>(<span class="ruby-identifier">:include?</span>)
51:       <span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:include</span>, <span class="ruby-ivar">@action_module</span>
52: 
53:       <span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">read_inheritable_attribute</span>(<span class="ruby-identifier">:resourceful_callbacks</span>).<span class="ruby-identifier">merge!</span> <span class="ruby-ivar">@callbacks</span>
54:       <span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">read_inheritable_attribute</span>(<span class="ruby-identifier">:resourceful_responses</span>).<span class="ruby-identifier">merge!</span> <span class="ruby-ivar">@responses</span>
55:       <span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">write_inheritable_attribute</span>(<span class="ruby-identifier">:made_resourceful</span>, <span class="ruby-keyword kw">true</span>)
56: 
57:       <span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">write_inheritable_attribute</span>(<span class="ruby-identifier">:parents</span>, <span class="ruby-ivar">@parents</span>)
58:       <span class="ruby-identifier">kontroller</span>.<span class="ruby-identifier">before_filter</span> <span class="ruby-identifier">:load_parent_object</span>, <span class="ruby-identifier">:only</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ok_actions</span>
59:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000065" class="method-detail">
        <a name="M000065"></a>

        <div class="method-heading">
          <a href="#M000065" class="method-signature">
          <span class="method-name">before(*events) { ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up a block of code to run <a href="Builder.html#M000065">before</a>
one or more events.
</p>
<p>
All the default <a href="Builder.html#M000063">actions</a> can be used as
<tt><a href="Builder.html#M000065">before</a></tt> events: <tt>:index</tt>,
<tt>:show</tt>, <tt>:create</tt>, <tt>:update</tt>, <tt>:<a
href="Builder.html#M000061">new</a></tt>, <tt>:edit</tt>, and
<tt>:destroy</tt>.
</p>
<p>
<tt><a href="Builder.html#M000065">before</a></tt> events are run <a
href="Builder.html#M000066">after</a> any objects are <a
href="Default/Accessors.html#M000015">loaded</a>, but <a
href="Builder.html#M000065">before</a> any database operations or
responses.
</p>
<p>
For example:
</p>
<pre>
  before :show, :edit do
    @page_title = current_object.title
  end
</pre>
<p>
This will set the <tt>@page_title</tt> variable to the current
object&#8216;s title for the show and edit <a
href="Builder.html#M000063">actions</a>.
</p>
<p>
Successive <a href="Builder.html#M000065">before</a> blocks for the same
action will be chained and executed in order when the event occurs.
</p>
<p>
For example:
</p>
<pre>
  before :show, :edit do
    @page_title = current_object.title
  end

  before :show do
    @side_bar = true
  end
</pre>
<p>
These <a href="Builder.html#M000065">before</a> blocks will both be
executed for the show action and in the same order as they were defined.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000065-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000065-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 128</span>
128:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">events</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
129:       <span class="ruby-identifier">add_callback</span> <span class="ruby-identifier">:before</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">events</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
130:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">belongs_to</span><span class="method-args">(*parents)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Specifies parent resources for the current resource. Each of these parents
will be loaded automatically if the proper id parameter is given. For
example,
</p>
<pre>
  # cake_controller.rb
  belongs_to :baker, :customer
</pre>
<p>
Then on GET /bakers/12/cakes,
</p>
<pre>
  params[:baker_id] #=&gt; 12
  parent?           #=&gt; true
  parent_name       #=&gt; &quot;baker&quot;
  parent_model      #=&gt; Baker
  parent_object     #=&gt; Baker.find(12)
  current_objects   #=&gt; Baker.find(12).cakes
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 326</span>
326:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">belongs_to</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">parents</span>)
327:       <span class="ruby-ivar">@parents</span> = <span class="ruby-identifier">parents</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_s</span>)
328:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000064" class="method-detail">
        <a name="M000064"></a>

        <div class="method-heading">
          <span class="method-name">build</span><span class="method-args">(*available_actions)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Builder.html#M000063">actions</a>
</p>
        </div>
      </div>

      <div id="method-M000070" class="method-detail">
        <a name="M000070"></a>

        <div class="method-heading">
          <a href="#M000070" class="method-signature">
          <span class="method-name">inherited?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is only meant to be called internally.
</p>
<p>
Returns whether or not the <a href="Builder.html">Builder</a>&#8216;s
controller inherits make_resourceful settings from a parent controller.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000070-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000070-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 334</span>
334:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inherited?</span>
335:       <span class="ruby-ivar">@inherited</span>
336:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">publish *formats, options = {}, :attributes => [ ... ]<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Builder.html#M000068">publish</a> allows you to easily expose
information about resourcess in a variety of formats. The <tt>formats</tt>
parameter is a list of formats in which to <a
href="Builder.html#M000068">publish</a> the resources. The formats
supported by default are <tt>xml</tt>, <tt>yaml</tt>, and <tt>json</tt>,
but other formats may be added by defining <tt>to_format</tt> methods for
the <a href="../Array.html">Array</a> and Hash classes and registering the
mime type with Rails&#8217; <a
href="http://api.rubyonrails.org/classes/Mime/Type.html#M001115">Mime::Type.register</a>.
See <a href="Serialize.html">Resourceful::Serialize</a> for more details..
</p>
<p>
The <tt>:attributes</tt> option is mandatory. It takes an array of
attributes (as symbols) to make public. These attributes can refer to any
method on current_object; they aren&#8216;t limited to database fields. For
example:
</p>
<pre>
  # posts_controller.rb
  publish :yaml, :attributes =&gt; [:title, :created_at, :rendered_content]
</pre>
<p>
Then GET /posts/12.yaml would render
</p>
<pre>
  ---
  post:
    title: Cool Stuff
    rendered_content: |-
      &lt;p&gt;This is a post.&lt;/p&gt;
      &lt;p&gt;It's about &lt;strong&gt;really&lt;/strong&gt; cool stuff.&lt;/p&gt;
    created_at: 2007-04-28 04:32:08 -07:00
</pre>
<p>
The <tt>:attributes</tt> array can even contain attributes that are
themselves models. In this case, you must use a hash to specify their
attributes as well. For example:
</p>
<pre>
  # person_controller.rb
  publish :xml, :json, :attributes =&gt; [
    :name, :favorite_color, {
    :pet_cat =&gt; [:name, :breed],
    :hat =&gt; [:type]
  }]
</pre>
<p>
Then GET /people/18.xml would render
</p>
<pre>
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
  &lt;person&gt;
    &lt;name&gt;Nathan&lt;/name&gt;
    &lt;favorite-color&gt;blue&lt;/favorite_color&gt;
    &lt;pet-cat&gt;
      &lt;name&gt;Jasmine&lt;/name&gt;
      &lt;breed&gt;panther&lt;/breed&gt;
    &lt;/pet-cat&gt;
    &lt;hat&gt;
      &lt;type&gt;top&lt;/type&gt;
    &lt;/hat&gt;
  &lt;/person&gt;
</pre>
<p>
<a href="Builder.html#M000068">publish</a> will also allow the
<tt>index</tt> action to render lists of objects. An example would be too
big, but play with it a little on your own to see.
</p>
<p>
<a href="Builder.html#M000068">publish</a> takes only one optional option:
<tt>only</tt>. This specifies which action to <a
href="Builder.html#M000068">publish</a> the resources for. By default,
they&#8216;re published for both <tt>show</tt> and <tt>index</tt>. For
example:
</p>
<pre>
  # cats_controller.rb
  publish :json, :only =&gt; :index, :attributes =&gt; [:name, :breed]
</pre>
<p>
Then GET /cats.json would work, but GET /cats/294.json would fail.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 291</span>
291:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">publish</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">formats</span>)
292:       <span class="ruby-identifier">options</span> = {
293:         <span class="ruby-identifier">:only</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:show</span>, <span class="ruby-identifier">:index</span>]
294:       }.<span class="ruby-identifier">merge</span>(<span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">formats</span>.<span class="ruby-identifier">last</span> <span class="ruby-value">? </span><span class="ruby-identifier">formats</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {})
295:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Must specify :attributes option&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:attributes</span>]
296:       
297:       <span class="ruby-constant">Array</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:only</span>)).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span><span class="ruby-operator">|</span>
298:         <span class="ruby-ivar">@publish</span>[<span class="ruby-identifier">action</span>] <span class="ruby-operator">||=</span> []
299:         <span class="ruby-identifier">formats</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
300:           <span class="ruby-identifier">format</span> = <span class="ruby-identifier">format</span>.<span class="ruby-identifier">to_sym</span>
301:           <span class="ruby-ivar">@publish</span>[<span class="ruby-identifier">action</span>] <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">format</span>, <span class="ruby-identifier">proc</span> <span class="ruby-keyword kw">do</span>
302:             <span class="ruby-identifier">render_action</span> = [<span class="ruby-identifier">:json</span>, <span class="ruby-identifier">:xml</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">format</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">format</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:text</span>
303:             <span class="ruby-identifier">render</span> <span class="ruby-identifier">render_action</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">plural_action?</span> <span class="ruby-value">? </span><span class="ruby-identifier">current_objects</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">current_object</span>).<span class="ruby-identifier">serialize</span>(<span class="ruby-identifier">format</span>, <span class="ruby-identifier">options</span>)
304:           <span class="ruby-keyword kw">end</span>]
305:         <span class="ruby-keyword kw">end</span>
306:       <span class="ruby-keyword kw">end</span>
307:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000067" class="method-detail">
        <a name="M000067"></a>

        <div class="method-heading">
          <a href="#M000067" class="method-signature">
          <span class="method-name">response_for(*actions) { ... }<br />
response_for(*actions) { |format| ... }<br />
</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up a block of code to run instead of the default responses for one or
more events.
</p>
<p>
If the block takes a format parameter, it has the same semantics as
Rails&#8217; <tt>respond_to</tt> method. Various format methods are called
on the format object with blocks that say what to do for each format. For
example:
</p>
<pre>
  response_for :index do |format|
    format.html
    format.atom do
      headers['Content-Type'] = 'application/atom+xml; charset=utf-8'
      render :action =&gt; 'atom', :layout =&gt; false
    end
  end
</pre>
<p>
This doesn&#8216;t do anything special for the HTML other than ensure that
the proper view will be rendered, but for ATOM it sets the proper content
type and renders the atom template.
</p>
<p>
If you only need to set the HTML response, you can omit the format
parameter. For example:
</p>
<pre>
  response_for :new do
    render :action =&gt; 'edit'
  end
</pre>
<p>
This is the same as
</p>
<pre>
  response_for :new do |format|
    format.html { render :action =&gt; 'edit' }
  end
</pre>
<p>
The default responses are defined by <a
href="Default/Responses.html#M000011">Default::Responses.included</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000067-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000067-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/make_resourceful/lib/resourceful/builder.rb, line 202</span>
202:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">response_for</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">actions</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
203:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Must specify one or more actions for response_for.&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">empty?</span>
204: 
205:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">arity</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
206:         <span class="ruby-identifier">response_for</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">actions</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
207:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
208:         <span class="ruby-keyword kw">end</span>
209:       <span class="ruby-keyword kw">else</span>
210:         <span class="ruby-identifier">response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span>
211:         <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">response</span>
212: 
213:         <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span><span class="ruby-operator">|</span>
214:           <span class="ruby-ivar">@responses</span>[<span class="ruby-identifier">action</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">formats</span>
215:         <span class="ruby-keyword kw">end</span>
216:       <span class="ruby-keyword kw">end</span>
217:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>