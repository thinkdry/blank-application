<% form_for_item @current_object, title do |f| -%>

  <% f.field :people, :label => I18n.t('groups.field.people_label')+' :' do %>
      <input type="hidden" name="group_id" id="group_id" value="<%=@group.id%>">
        <div id="select_boxes">
          <%a =[]; @group.groupings.collect{|member| a << member.groupable_type.downcase+'_'+member.groupable_id.to_s} %>
         <input type="hidden" name="selected_Options" id="selected_Options" value="<%= a.join(',').to_s%>">
          <div id="left_select_box">
        	<div class="optionAssignmentLabel">
               <%= I18n.t('groups.field.available_people_label') %>
              <select id="start_with" name="start_with" style="width: 60px;" onchange="show_people();" >
                <option value="tous">Tous</option>
                <% ('a'..'z').each do |alpha| %>
                  <option value="<%=alpha%>"><%= alpha.capitalize%></option>
                <% end %>
                <option value="0-9">0-9</option>
              </select>
              <script type='text/javascript'>
                function show_people(){
                  new Ajax.Request('/people/filter/?start_with='+$('start_with').value+'&group_id='+$('group_id').value, {asynchronous:true, evalScripts:true})
                }
              </script>
            </div>
            <select name="assignedPeople" id="assignedOptions" size="5" multiple class="theatreSelection" >
              <% for mem in @current_user.get_member_for_groups %>
                <%= content_tag(:option, mem[:email], :value => mem[:model]+'_'+mem[:id].to_s) if !@group.groupings.include?(Grouping.find(:first, :conditions => {:group_id => @group.id,:groupable_id => mem[:id], :groupable_type => mem[:model] }))%>
              <% end %>
        	</select>
             <br />
            <div id="send_all_buttons">
              <input type="button" onclick="selectAll($('assignedOptions'),'assignedOptions')" value ="Tout sélectionner" style="width:180px;"/>
            </div>
            <script type="text/javascript" charset="utf-8">
              function selectAll(chkObj,id){
                var multi=document.getElementById(id);
                if(chkObj)
                  for(i=0;i<multi.options.length;i++)
                    multi.options[i].selected=true;
                else
                  for(i=0;i<multi.options.length;i++)
                    multi.options[i].selected=false;


              }
            </script>
          </div>
		  <div id="left_right_buttons">
            <input type="button" class="sendLeftButton" onclick="shiftRight('availableOptions','assignedOptions', true)" class="theatreAssignment"/>
			<br /><br />
			<input type="button" class="sendRightButton" onclick="shiftLeft('assignedOptions','availableOptions', false)" class="theatreAssignment"/>
          </div>
		  <div id="right_select_box" >
            <div class="optionAssignmentLabel"> <%= I18n.t('groups.field.assigned_people_label') %></div>
            <select name="availableOptions" id="availableOptions" size="5" multiple >
                <% for group_member in @group.groupings %>
                  <%= content_tag(:option, group_member.member.email, :value => group_member.groupable_type.downcase+'_'+group_member.groupable_id.to_s) %>
                <% end %>
            </select>
            <div id="send_all_buttons">
              <input type="button" onclick="selectAll($('availableOptions'),'availableOptions')" value ="Tout sélectionner" style="width:180px;"/>
            </div>
          </div>
     <% end %>
<% end -%>
